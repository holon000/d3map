var Promise = require('promise');

module.exports = node;

function node(fn) {
  return function () {
    var self = this;
    var args = Array.prototype.slice.call(arguments);
    return new Promise(function (resolver) {
      args.push(function (err, res) {
        if (err) resolver.reject(err);
        else resolver.fulfill(res);
      });
      try {
        fn.apply(self, args);
      } catch (ex) {
        resolver.reject(ex);
      }
    })
  };
}